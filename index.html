<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        #container {
            width: 80%;
            margin: auto;
        }
        .annotation {
            font-size: 12px;
            fill: darkred;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        // Define parameters and initial scene
        let currentScene = 0;
        const scenes = [
            { description: "Overview of the data", func: scene1 },
            { description: "Highlighting trends", func: scene2 },
            { description: "Explore the data", func: scene3 }
        ];

        // Load the CSV data
        d3.csv("/mnt/data/cars2017.csv").then(data => {
            setupScene();

            // Set up button to switch scenes
            d3.select("body").append("button")
                .text("Next")
                .on("click", () => {
                    currentScene = (currentScene + 1) % scenes.length;
                    setupScene();
                });

            function setupScene() {
                d3.select("#container").html(""); // Clear the container
                scenes[currentScene].func(data); // Render the current scene
            }
        });

        // Scene 1: Overview of the data
        function scene1(data) {
            const svg = d3.select("#container").append("svg")
                .attr("width", 800)
                .attr("height", 500);

            svg.append("text")
                .attr("x", 50)
                .attr("y", 50)
                .text(scenes[0].description)
                .attr("class", "annotation");

            // Example visualization: Scatter plot
            svg.selectAll("circle")
                .data(data)
                .enter().append("circle")
                .attr("cx", (d, i) => i * 5)
                .attr("cy", d => 500 - d["MPG"])
                .attr("r", 2)
                .style("fill", "steelblue");
        }

        // Scene 2: Highlighting trends
        function scene2(data) {
            const svg = d3.select("#container").append("svg")
                .attr("width", 800)
                .attr("height", 500);

            svg.append("text")
                .attr("x", 50)
                .attr("y", 50)
                .text(scenes[1].description)
                .attr("class", "annotation");

            // Example visualization: Bar chart
            const barWidth = 20;
            svg.selectAll("rect")
                .data(data)
                .enter().append("rect")
                .attr("x", (d, i) => i * barWidth)
                .attr("y", d => 500 - d["Horsepower"])
                .attr("width", barWidth - 1)
                .attr("height", d => d["Horsepower"])
                .style("fill", "orange");
        }

        // Scene 3: Explore the data
        function scene3(data) {
            const svg = d3.select("#container").append("svg")
                .attr("width", 800)
                .attr("height", 500);

            svg.append("text")
                .attr("x", 50)
                .attr("y", 50)
                .text(scenes[2].description)
                .attr("class", "annotation");

            // Interactive scatter plot
            svg.selectAll("circle")
                .data(data)
                .enter().append("circle")
                .attr("cx", d => d["MPG"] * 10)
                .attr("cy", d => 500 - d["Horsepower"])
                .attr("r", 5)
                .style("fill", "lightgreen")
                .on("mouseover", (event, d) => {
                    const [x, y] = d3.pointer(event);
                    svg.append("text")
                        .attr("x", x)
                        .attr("y", y - 10)
                        .text(`MPG: ${d["MPG"]}, HP: ${d["Horsepower"]}`)
                        .attr("class", "annotation")
                        .attr("id", "tooltip");
                })
                .on("mouseout", () => {
                    svg.select("#tooltip").remove();
                });
        }
    </script>
</body>
</html>
